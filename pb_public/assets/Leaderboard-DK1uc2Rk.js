import{p as _,u as E,r as h,c as S,q as j,o as W,s as B,b as T,w as F,U as N,e as i,g as d,h as w,f as e,t as c,i as z,v as R,F as y,k as b,n as M}from"./index-Cjug_FY0.js";import{r as U}from"./realtimeService-MWF2GRb6.js";class O{async calculateOverallRankings(){try{const n=await _.pb.collection("submissions").getFullList({expand:"user,quiz",sort:"-created"}),r=this.groupSubmissionsByUser(n);return Object.values(r).map(t=>({userId:t.userId,username:t.username,name:t.name,avatar:t.avatar,totalQuizzes:t.submissions.length,averageScore:this.calculateAverage(t.submissions.map(l=>l.score||0)),totalPoints:t.submissions.reduce((l,g)=>l+(g.score||0),0),improvementRate:this.calculateImprovementRate(t.submissions),consistencyScore:this.calculateConsistency(t.submissions),recentActivity:this.getRecentActivityScore(t.submissions),category:this.getPreferredCategory(t.submissions)})).filter(t=>t.totalQuizzes>=1).sort((t,l)=>this.calculateWeightedScore(l)-this.calculateWeightedScore(t))}catch(n){return console.error("Error calculating overall rankings:",n),[]}}async calculateCategoryRankings(n){try{const r=await _.pb.collection("submissions").getFullList({filter:`quiz.category = "${n}"`,expand:"user,quiz",sort:"-created"}),s=this.groupSubmissionsByUser(r);return Object.values(s).map(t=>({userId:t.userId,username:t.userId,name:t.name,score:this.calculateAverage(t.submissions.map(l=>l.score||0)),quizzesCompleted:t.submissions.length})).filter(t=>t.quizzesCompleted>=1).sort((t,l)=>l.score-t.score).slice(0,5)}catch(r){return console.error(`Error calculating ${n} rankings:`,r),[]}}async calculateMostActiveRankings(){try{const n=await _.pb.collection("submissions").getFullList({expand:"user,quiz",sort:"-created"}),r=this.groupSubmissionsByUser(n);return Object.values(r).map(s=>({userId:s.userId,username:s.username,name:s.name,quizzesCompleted:s.submissions.length,recentActivity:this.getRecentActivityScore(s.submissions),studyStreak:this.calculateStudyStreak(s.submissions)})).filter(s=>s.quizzesCompleted>=1).sort((s,t)=>t.quizzesCompleted-s.quizzesCompleted).slice(0,10)}catch(n){return console.error("Error calculating most active rankings:",n),[]}}async calculateMostImprovedRankings(){try{const n=await _.pb.collection("submissions").getFullList({expand:"user,quiz",sort:"-created"}),r=this.groupSubmissionsByUser(n);return Object.values(r).map(s=>({userId:s.userId,username:s.username,name:s.name,improvementRate:this.calculateImprovementRate(s.submissions),totalQuizzes:s.submissions.length,averageScore:this.calculateAverage(s.submissions.map(t=>t.score||0))})).filter(s=>s.totalQuizzes>=5).sort((s,t)=>t.improvementRate-s.improvementRate).slice(0,10)}catch(n){return console.error("Error calculating most improved rankings:",n),[]}}groupSubmissionsByUser(n){const r={};return n.forEach(s=>{const t=s.user,l=s.expand?.user;r[t]||(r[t]={userId:t,username:l?.username||"Unknown",name:l?.name||"Unknown User",avatar:l?.avatar||null,submissions:[]}),r[t].submissions.push(s)}),r}calculateWeightedScore(n){const{averageScore:r,totalQuizzes:s,improvementRate:t,consistencyScore:l,recentActivity:g}=n;return r*.4+Math.min(s/20,1)*100*.25+Math.max(t,0)*.2+l*.15}calculateImprovementRate(n){if(n.length<5)return 0;const r=n.sort((m,p)=>new Date(m.created)-new Date(p.created)),s=r.slice(0,Math.ceil(r.length/2)),t=r.slice(Math.ceil(r.length/2)),l=this.calculateAverage(s.map(m=>m.score||0)),g=this.calculateAverage(t.map(m=>m.score||0));return Math.round(g-l)}calculateConsistency(n){if(n.length<2)return 100;const r=n.map(g=>g.score||0),s=this.calculateAverage(r),t=r.reduce((g,m)=>g+Math.pow(m-s,2),0)/r.length,l=Math.sqrt(t);return Math.max(0,100-l)}getRecentActivityScore(n){if(n.length===0)return 0;const r=new Date;return n.filter(t=>{const l=new Date(t.created);return r-l<10080*60*1e3}).length}calculateStudyStreak(n){if(n.length===0)return 0;const r=n.map(l=>new Date(l.created).toDateString()),s=[...new Set(r)].sort();let t=1;for(let l=s.length-1;l>0;l--){const g=new Date(s[l]),m=new Date(s[l-1]);if(Math.floor((g-m)/(1e3*60*60*24))===1)t++;else break}return t}getPreferredCategory(n){if(n.length===0)return"Unknown";const r={};return n.forEach(s=>{const t=s.expand?.quiz?.category;t&&(r[t]=(r[t]||0)+1)}),Object.keys(r).reduce((s,t)=>r[s]>r[t]?s:t,"Unknown")}calculateAverage(n){return!n||n.length===0?0:Math.round(n.reduce((r,s)=>r+s,0)/n.length)}async getUserRank(n){try{const s=(await this.calculateOverallRankings()).findIndex(t=>t.userId===n);return s!==-1?s+1:"N/A"}catch(r){return console.error("Error getting user rank:",r),"N/A"}}}const k=new O,Q={key:0,class:"bg-white rounded-xl shadow-lg p-8 mb-8"},V={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-8 mb-8"},D={class:"flex items-center"},H={class:"ml-3"},Y={class:"text-red-700"},$={key:2,class:"bg-gradient-to-r from-purple-600 to-indigo-700 rounded-xl shadow-lg p-8 text-white mb-8"},G={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between"},J={class:"mt-6 lg:mt-0"},K={class:"text-center"},X={class:"text-4xl font-bold"},Z={key:3,class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-8"},ee={class:"flex flex-wrap items-center gap-4"},te={key:4,class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-8"},se={class:"space-y-4"},re={class:"flex-1"},oe={class:"flex items-center"},ne={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mr-3"},ae={class:"text-white text-sm font-medium"},le={class:"font-medium text-gray-900"},ie={class:"text-sm text-gray-500"},ce={class:"text-right"},de={class:"text-2xl font-bold text-gray-900"},ue={class:"text-sm text-gray-500"},me={class:"ml-4"},ge={key:0,class:"text-2xl"},ve={key:1,class:"text-2xl"},pe={key:2,class:"text-2xl"},he={key:3,class:"text-gray-400"},ye={key:5,class:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8"},be={class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6"},xe={class:"space-y-3"},fe={class:"flex items-center"},_e={class:"text-sm font-medium text-gray-700 mr-2"},we={class:"text-sm text-gray-900"},ke={class:"text-sm font-semibold text-blue-600"},Se={class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6"},ze={class:"space-y-3"},Re={class:"flex items-center"},Ae={class:"text-sm font-medium text-gray-700 mr-2"},Ce={class:"text-sm text-gray-900"},Me={class:"text-sm font-semibold text-green-600"},Ue={class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6"},Le={class:"space-y-3"},Ie={class:"flex items-center"},qe={class:"text-sm font-medium text-gray-700 mr-2"},Pe={class:"text-sm text-gray-900"},Ee={class:"text-sm font-semibold text-purple-600"},je={key:6,class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6"},We={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Be={class:"text-3xl mb-2"},Te={class:"font-medium text-gray-900 mb-1"},Fe={class:"text-sm text-gray-600"},Ne={class:"text-xs text-gray-500 mt-1"},Ve={__name:"Leaderboard",setup(L){const n=E(),r=h({timePeriod:"week",category:"all",difficulty:"all"}),s=h([]),t=h({excel:[],python:[],pandas:[]}),l=h([]),g=h(!0),m=h(null),p=S(()=>n.user),x=S(()=>p.value?.id),A=S(()=>{const u=s.value.findIndex(o=>o.id===x.value);return u!==-1?u+1:"N/A"}),I=u=>u===1?"bg-yellow-400 text-white":u===2?"bg-gray-300 text-white":u===3?"bg-orange-400 text-white":"bg-gray-200 text-gray-700",q=u=>u?u.split(" ").map(o=>o[0]).join("").toUpperCase().slice(0,2):"U",P=u=>new Date(u).toLocaleDateString(),f=async()=>{g.value=!0,m.value=null;try{const u=await k.calculateOverallRankings();s.value=u.slice(0,10);const[o,a,v]=await Promise.all([k.calculateCategoryRankings("Excel"),k.calculateCategoryRankings("Python"),k.calculateCategoryRankings("Pandas")]);t.value={excel:o,python:a,pandas:v},l.value=[{id:1,name:"Perfect Score",icon:"ðŸ†",student:"Recent Achiever",date:new Date},{id:2,name:"Streak Master",icon:"ðŸ”¥",student:"Active Learner",date:new Date(Date.now()-1440*60*1e3)},{id:3,name:"Speed Demon",icon:"âš¡",student:"Quick Thinker",date:new Date(Date.now()-2880*60*1e3)},{id:4,name:"First Quiz",icon:"ðŸŽ¯",student:"New Student",date:new Date(Date.now()-4320*60*1e3)}]}catch(u){m.value="An error occurred while loading leaderboard data",console.error("Error loading leaderboard data:",u)}finally{g.value=!1}};j(()=>p.value?.id,u=>{u&&(f(),C())});const C=()=>{U.subscribeToLeaderboardUpdates(u=>{console.log("Leaderboard real-time update received:",u),f()})};return W(()=>{p.value?.id&&(f(),C())}),B(()=>{U.unsubscribeFromLeaderboardUpdates()}),(u,o)=>(i(),T(N,null,{default:F(()=>[g.value?(i(),d("div",Q,[...o[3]||(o[3]=[e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"}),e("span",{class:"ml-3 text-lg text-gray-600"},"Loading leaderboard data...")],-1)])])):m.value?(i(),d("div",V,[e("div",D,[o[5]||(o[5]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",H,[o[4]||(o[4]=e("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Leaderboard",-1)),e("p",Y,c(m.value),1),e("button",{onClick:f,class:"mt-2 text-red-600 hover:text-red-500 underline"}," Try Again ")])])])):(i(),d("div",$,[e("div",G,[o[7]||(o[7]=e("div",{class:"flex-1"},[e("h1",{class:"text-3xl font-bold mb-2"},"Leaderboard"),e("p",{class:"text-purple-100 text-lg"}," Compete with your peers and track your ranking ")],-1)),e("div",J,[e("div",K,[e("div",X,"#"+c(A.value),1),o[6]||(o[6]=e("div",{class:"text-purple-100"},"Your Current Rank",-1))])])])])),!g.value&&!m.value?(i(),d("div",Z,[e("div",ee,[e("div",null,[o[9]||(o[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Time Period",-1)),z(e("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>r.value.timePeriod=a),class:"border border-gray-300 rounded-md px-3 py-2 text-sm"},[...o[8]||(o[8]=[e("option",{value:"week"},"This Week",-1),e("option",{value:"month"},"This Month",-1),e("option",{value:"all"},"All Time",-1)])],512),[[R,r.value.timePeriod]])]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Category",-1)),z(e("select",{"onUpdate:modelValue":o[1]||(o[1]=a=>r.value.category=a),class:"border border-gray-300 rounded-md px-3 py-2 text-sm"},[...o[10]||(o[10]=[e("option",{value:"all"},"All Categories",-1),e("option",{value:"excel"},"Excel",-1),e("option",{value:"python"},"Python",-1),e("option",{value:"pandas"},"Pandas",-1)])],512),[[R,r.value.category]])]),e("div",null,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Difficulty",-1)),z(e("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>r.value.difficulty=a),class:"border border-gray-300 rounded-md px-3 py-2 text-sm"},[...o[12]||(o[12]=[e("option",{value:"all"},"All Levels",-1),e("option",{value:"easy"},"Easy",-1),e("option",{value:"normal"},"Normal",-1),e("option",{value:"hard"},"Hard",-1),e("option",{value:"very-hard"},"Very Hard",-1)])],512),[[R,r.value.difficulty]])])])])):w("",!0),!g.value&&!m.value?(i(),d("div",te,[o[14]||(o[14]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Top Performers",-1)),e("div",se,[(i(!0),d(y,null,b(s.value,(a,v)=>(i(),d("div",{key:a.id,class:M(["flex items-center p-4 rounded-lg border transition-colors",a.id===x.value?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200 hover:bg-gray-100"])},[e("div",{class:M(["flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg mr-4",I(v+1)])},c(v+1),3),e("div",re,[e("div",oe,[e("div",ne,[e("span",ae,c(q(a.name)),1)]),e("div",null,[e("h3",le,c(a.id===x.value?"You":a.name),1),e("p",ie,c(a.category),1)])])]),e("div",ce,[e("div",de,c(a.score)+"%",1),e("div",ue,c(a.quizzesCompleted)+" quizzes",1)]),e("div",me,[v===0?(i(),d("span",ge,"ðŸ¥‡")):v===1?(i(),d("span",ve,"ðŸ¥ˆ")):v===2?(i(),d("span",pe,"ðŸ¥‰")):(i(),d("span",he,"#"+c(v+1),1))])],2))),128))])])):w("",!0),!g.value&&!m.value?(i(),d("div",ye,[e("div",be,[o[15]||(o[15]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Excel Expert",-1)),e("div",xe,[(i(!0),d(y,null,b(t.value.excel,(a,v)=>(i(),d("div",{key:a.id,class:"flex items-center justify-between"},[e("div",fe,[e("span",_e,"#"+c(v+1),1),e("span",we,c(a.name),1)]),e("span",ke,c(a.score)+"%",1)]))),128))])]),e("div",Se,[o[16]||(o[16]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Python Ninja",-1)),e("div",ze,[(i(!0),d(y,null,b(t.value.python,(a,v)=>(i(),d("div",{key:a.id,class:"flex items-center justify-between"},[e("div",Re,[e("span",Ae,"#"+c(v+1),1),e("span",Ce,c(a.name),1)]),e("span",Me,c(a.score)+"%",1)]))),128))])]),e("div",Ue,[o[17]||(o[17]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Pandas Master",-1)),e("div",Le,[(i(!0),d(y,null,b(t.value.pandas,(a,v)=>(i(),d("div",{key:a.id,class:"flex items-center justify-between"},[e("div",Ie,[e("span",qe,"#"+c(v+1),1),e("span",Pe,c(a.name),1)]),e("span",Ee,c(a.score)+"%",1)]))),128))])])])):w("",!0),!g.value&&!m.value?(i(),d("div",je,[o[18]||(o[18]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Recent Achievements",-1)),e("div",We,[(i(!0),d(y,null,b(l.value,a=>(i(),d("div",{key:a.id,class:"text-center p-4 bg-gradient-to-br from-yellow-50 to-orange-50 rounded-lg border border-yellow-200"},[e("div",Be,c(a.icon),1),e("h4",Te,c(a.name),1),e("p",Fe,c(a.student),1),e("p",Ne,c(P(a.date)),1)]))),128))])])):w("",!0)]),_:1}))}};export{Ve as default};
