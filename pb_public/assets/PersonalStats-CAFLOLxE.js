import{p as S,u as z,r as p,c as T,q as A,o as C,s as j,b as D,w as M,U as R,e as g,g as v,h as f,f as e,t as d,n as b,x as w,F as q,k as B}from"./index-Cjug_FY0.js";import{r as _}from"./realtimeService-MWF2GRb6.js";class U{async getUserSubmissions(r){try{return{success:!0,data:await S.pb.collection("submissions").getFullList({filter:`user = "${r}"`,expand:"quiz",sort:"-created"})}}catch(o){return{success:!1,error:o.message}}}calculateUserStatistics(r){if(!r||r.length===0)return{totalQuizzes:0,averageScore:0,bestScore:0,totalTime:0,currentRank:"N/A",categoryScores:{excel:0,python:0,pandas:0},improvementTrend:0,studyStreak:0};const o=r.length,s=r.map(m=>m.score||0),n=Math.round(s.reduce((m,l)=>m+l,0)/o),a=Math.max(...s),i=r.reduce((m,l)=>m+(l.duration||0),0)/3600,h=this.calculateCategoryPerformance(r),u=this.calculateImprovementTrend(r),c=this.calculateStudyStreak(r);return{totalQuizzes:o,averageScore:n,bestScore:a,totalTime:Math.round(i*10)/10,currentRank:"N/A",categoryScores:h,improvementTrend:u,studyStreak:c}}calculateCategoryPerformance(r){const o={excel:[],python:[],pandas:[]};return r.forEach(s=>{if(s.expand?.quiz?.category){const n=s.expand.quiz.category.toLowerCase();o[n]&&o[n].push(s.score||0)}}),{excel:this.calculateAverage(o.excel),python:this.calculateAverage(o.python),pandas:this.calculateAverage(o.pandas)}}calculateImprovementTrend(r){if(r.length<10)return 0;const o=r.slice(-5).map(i=>i.score||0),s=r.slice(0,5).map(i=>i.score||0),n=this.calculateAverage(o),a=this.calculateAverage(s);return Math.round(a-n)}calculateStudyStreak(r){if(r.length===0)return 0;const o=r.map(a=>new Date(a.created).toDateString()),s=[...new Set(o)].sort();let n=1;for(let a=s.length-1;a>0;a--){const i=new Date(s[a]),h=new Date(s[a-1]);if(Math.floor((i-h)/(1e3*60*60*24))===1)n++;else break}return n}calculateAverage(r){return!r||r.length===0?0:Math.round(r.reduce((o,s)=>o+s,0)/r.length)}getRecentResults(r,o=5){return r.slice(0,o).map(s=>({id:s.id,quizName:s.expand?.quiz?.title||"Unknown Quiz",category:s.expand?.quiz?.category||"Unknown",score:s.score||0,date:s.created}))}getTimeAnalytics(r){if(!r||r.length===0)return{totalStudyTime:0,averageTimePerQuiz:0,mostActiveHours:[],studyFrequency:{daily:0,weekly:0,monthly:0}};const o=r.reduce((u,c)=>u+(c.duration||0),0),s=o/r.length,n=new Date,a=r.filter(u=>{const c=new Date(u.created);return n-c<1440*60*1e3}).length,i=r.filter(u=>{const c=new Date(u.created);return n-c<10080*60*1e3}).length,h=r.filter(u=>{const c=new Date(u.created);return n-c<720*60*60*1e3}).length;return{totalStudyTime:Math.round(o/3600*10)/10,averageTimePerQuiz:Math.round(s/60),studyFrequency:{daily:a,weekly:i,monthly:h}}}}const y=new U,L={key:0,class:"bg-white rounded-xl shadow-lg p-8 mb-8"},P={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-8 mb-8"},Q={class:"flex items-center"},F={class:"ml-3"},N={class:"text-red-700"},E={key:2,class:"bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl shadow-lg p-8 text-white mb-8"},V={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between"},H={class:"mt-6 lg:mt-0"},I={class:"text-center"},O={class:"text-4xl font-bold"},$={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8"},G={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200"},J={class:"flex items-center"},K={class:"ml-4"},W={class:"text-2xl font-bold text-gray-900"},X={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200"},Y={class:"flex items-center"},Z={class:"ml-4"},ee={class:"text-2xl font-bold text-gray-900"},te={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200"},se={class:"flex items-center"},re={class:"ml-4"},oe={class:"text-2xl font-bold text-gray-900"},ae={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200"},le={class:"flex items-center"},ne={class:"ml-4"},ie={class:"text-2xl font-bold text-gray-900"},de={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200"},ce={class:"flex items-center"},ue={class:"ml-4"},ge={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200"},me={class:"flex items-center"},xe={class:"ml-4"},ve={class:"text-2xl font-bold text-gray-900"},he={key:4,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},pe={class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6"},ye={class:"space-y-4"},fe={class:"flex items-center justify-between"},we={class:"flex items-center"},be={class:"w-20 bg-gray-200 rounded-full h-2 mr-2"},_e={class:"text-sm font-medium text-gray-900"},ke={class:"flex items-center justify-between"},Se={class:"flex items-center"},ze={class:"w-20 bg-gray-200 rounded-full h-2 mr-2"},Te={class:"text-sm font-medium text-gray-900"},Ae={class:"flex items-center justify-between"},Ce={class:"flex items-center"},je={class:"w-20 bg-gray-200 rounded-full h-2 mr-2"},De={class:"text-sm font-medium text-gray-900"},Me={key:5,class:"mt-8 bg-white rounded-xl shadow-lg border border-gray-200 p-6"},Re={class:"overflow-x-auto"},qe={class:"min-w-full divide-y divide-gray-200"},Be={class:"bg-white divide-y divide-gray-200"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pe={class:"px-6 py-4 whitespace-nowrap"},Qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ee={__name:"PersonalStats",setup(k){const r=z(),o=p([]),s=p({quizzesCompleted:0,averageScore:0,bestScore:0,totalTime:0,currentRank:"N/A",categoryScores:{excel:0,python:0,pandas:0},improvementTrend:0,studyStreak:0}),n=p(!0),a=p(null),i=T(()=>r.user),h=l=>l>=90?"text-green-600 font-semibold":l>=80?"text-blue-600 font-semibold":l>=70?"text-yellow-600 font-semibold":"text-red-600 font-semibold",u=l=>new Date(l).toLocaleDateString(),c=async()=>{if(i.value?.id){n.value=!0,a.value=null;try{const l=await y.getUserSubmissions(i.value.id);if(l.success){const t=l.data;s.value=y.calculateUserStatistics(t),o.value=y.getRecentResults(t,5);const x=y.getTimeAnalytics(t);s.value.totalTime=x.totalStudyTime}else a.value=l.error||"Failed to load statistics"}catch(l){a.value="An error occurred while loading statistics",console.error("Error loading statistics:",l)}finally{n.value=!1}}};A(()=>i.value?.id,l=>{l&&(c(),m(l))});const m=l=>{_.subscribeToUserSubmissions(l,t=>{console.log("Real-time update received:",t),c()})};return C(()=>{i.value?.id&&(c(),m(i.value.id))}),j(()=>{i.value?.id&&_.unsubscribeFromUserSubmissions(i.value.id)}),(l,t)=>(g(),D(R,null,{default:M(()=>[n.value?(g(),v("div",L,[...t[0]||(t[0]=[e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e("span",{class:"ml-3 text-lg text-gray-600"},"Loading your statistics...")],-1)])])):a.value?(g(),v("div",P,[e("div",Q,[t[2]||(t[2]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",F,[t[1]||(t[1]=e("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Statistics",-1)),e("p",N,d(a.value),1),e("button",{onClick:c,class:"mt-2 text-red-600 hover:text-red-500 underline"}," Try Again ")])])])):(g(),v("div",E,[e("div",V,[t[4]||(t[4]=e("div",{class:"flex-1"},[e("h1",{class:"text-3xl font-bold mb-2"},"Personal Statistics"),e("p",{class:"text-blue-100 text-lg"}," Track your learning progress and performance insights ")],-1)),e("div",H,[e("div",I,[e("div",O,d(s.value.averageScore)+"%",1),t[3]||(t[3]=e("div",{class:"text-blue-100"},"Overall Average",-1))])])])])),!n.value&&!a.value?(g(),v("div",$,[e("div",G,[e("div",J,[t[6]||(t[6]=e("div",{class:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",K,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Quizzes",-1)),e("p",W,d(s.value.quizzesCompleted),1)])])]),e("div",X,[e("div",Y,[t[8]||(t[8]=e("div",{class:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),e("div",Z,[t[7]||(t[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Best Score",-1)),e("p",ee,d(s.value.bestScore)+"%",1)])])]),e("div",te,[e("div",se,[t[10]||(t[10]=e("div",{class:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",re,[t[9]||(t[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Study Time",-1)),e("p",oe,d(s.value.totalTime)+"h",1)])])]),e("div",ae,[e("div",le,[t[12]||(t[12]=e("div",{class:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1)),e("div",ne,[t[11]||(t[11]=e("p",{class:"text-sm font-medium text-gray-600"},"Current Rank",-1)),e("p",ie,"#"+d(s.value.currentRank),1)])])]),e("div",de,[e("div",ce,[t[14]||(t[14]=e("div",{class:"w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),e("div",ue,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Improvement Trend",-1)),e("p",{class:b(["text-2xl font-bold text-gray-900",s.value.improvementTrend>=0?"text-green-600":"text-red-600"])},d(s.value.improvementTrend>=0?"+":"")+d(s.value.improvementTrend)+"% ",3)])])]),e("div",ge,[e("div",me,[t[16]||(t[16]=e("div",{class:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"})])],-1)),e("div",xe,[t[15]||(t[15]=e("p",{class:"text-sm font-medium text-gray-600"},"Study Streak",-1)),e("p",ve,d(s.value.studyStreak)+" days",1)])])])])):f("",!0),!n.value&&!a.value?(g(),v("div",he,[t[21]||(t[21]=e("div",{class:"lg:col-span-2 bg-white rounded-xl shadow-lg border border-gray-200 p-6"},[e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Score Trend"),e("div",{class:"h-64 flex items-center justify-center bg-gray-50 rounded-lg"},[e("p",{class:"text-gray-500"},"Score trend chart will be displayed here")])],-1)),e("div",pe,[t[20]||(t[20]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Category Performance",-1)),e("div",ye,[e("div",fe,[t[17]||(t[17]=e("span",{class:"text-sm font-medium text-gray-700"},"Excel",-1)),e("div",we,[e("div",be,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:w({width:s.value.categoryScores.excel+"%"})},null,4)]),e("span",_e,d(s.value.categoryScores.excel)+"%",1)])]),e("div",ke,[t[18]||(t[18]=e("span",{class:"text-sm font-medium text-gray-700"},"Python",-1)),e("div",Se,[e("div",ze,[e("div",{class:"bg-green-600 h-2 rounded-full",style:w({width:s.value.categoryScores.python+"%"})},null,4)]),e("span",Te,d(s.value.categoryScores.python)+"%",1)])]),e("div",Ae,[t[19]||(t[19]=e("span",{class:"text-sm font-medium text-gray-700"},"Pandas",-1)),e("div",Ce,[e("div",je,[e("div",{class:"bg-purple-600 h-2 rounded-full",style:w({width:s.value.categoryScores.pandas+"%"})},null,4)]),e("span",De,d(s.value.categoryScores.pandas)+"%",1)])])])])])):f("",!0),!n.value&&!a.value?(g(),v("div",Me,[t[23]||(t[23]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Recent Quiz Results",-1)),e("div",Re,[e("table",qe,[t[22]||(t[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Quiz"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Category"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Score"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date")])],-1)),e("tbody",Be,[(g(!0),v(q,null,B(o.value,x=>(g(),v("tr",{key:x.id},[e("td",Ue,d(x.quizName),1),e("td",Le,d(x.category),1),e("td",Pe,[e("span",{class:b(h(x.score))},d(x.score)+"%",3)]),e("td",Qe,d(u(x.date)),1)]))),128))])])])])):f("",!0)]),_:1}))}};export{Ee as default};
