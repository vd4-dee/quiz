import{p as S,u as Q,r as w,c as q,q as M,o as R,s as T,b as j,w as C,U,e as m,g as x,h as k,f as e,t as g,x as _,F as B,k as P,n as D}from"./index-CKJZMbs9.js";import{r as A}from"./realtimeService-B2h0dO5p.js";class L{async getUserSubmissions(r){try{return{success:!0,data:await S.pb.collection("submissions").getFullList({filter:`user = "${r}"`,expand:"quiz",sort:"-created"})}}catch(o){return{success:!1,error:o.message}}}calculateUserStatistics(r){if(!r||r.length===0)return{totalQuizzes:0,averageScore:0,bestScore:0,totalTime:0,currentRank:"N/A",categoryScores:{excel:0,python:0,pandas:0},improvementTrend:0,studyStreak:0,totalPoints:0,uniqueQuestionsAnswered:0,accuracyRate:0,totalQuestionsAttempted:0,correctAnswers:0};const o=r.length,s=r.map(y=>y.score||0),a=Math.round(s.reduce((y,p)=>y+p,0)/o),n=Math.max(...s),l=r.reduce((y,p)=>y+(p.duration||0),0)/3600,i=r.reduce((y,p)=>y+(p.score||0),0),{uniqueQuestionsAnswered:c,totalQuestionsAttempted:d,correctAnswers:v}=this.calculateQuestionMetrics(r),u=d>0?Math.round(v/d*100):0,t=this.calculateCategoryPerformance(r),h=this.calculateImprovementTrend(r),b=this.calculateStudyStreak(r);return{totalQuizzes:o,averageScore:a,bestScore:n,totalTime:Math.round(l*10)/10,currentRank:"N/A",categoryScores:t,improvementTrend:h,studyStreak:b,totalPoints:i,uniqueQuestionsAnswered:c,accuracyRate:u,totalQuestionsAttempted:d,correctAnswers:v}}calculateQuestionMetrics(r){const o=new Set;let s=0,a=0;return r.forEach(n=>{n.answers&&Array.isArray(n.answers)&&n.answers.forEach(l=>{l.questionId&&(o.add(l.questionId),s++,l.isCorrect&&a++)})}),{uniqueQuestionsAnswered:o.size,totalQuestionsAttempted:s,correctAnswers:a}}calculateCategoryPerformance(r){const o={excel:[],python:[],pandas:[]};return r.forEach(s=>{if(s.expand?.quiz?.category){const a=s.expand.quiz.category.toLowerCase();o[a]&&o[a].push(s.score||0)}}),{excel:this.calculateAverage(o.excel),python:this.calculateAverage(o.python),pandas:this.calculateAverage(o.pandas)}}calculateImprovementTrend(r){if(r.length<10)return 0;const o=r.slice(-5).map(l=>l.score||0),s=r.slice(0,5).map(l=>l.score||0),a=this.calculateAverage(o),n=this.calculateAverage(s);return Math.round(n-a)}calculateStudyStreak(r){if(r.length===0)return 0;const o=r.map(n=>new Date(n.created).toDateString()),s=[...new Set(o)].sort();let a=1;for(let n=s.length-1;n>0;n--){const l=new Date(s[n]),i=new Date(s[n-1]);if(Math.floor((l-i)/(1e3*60*60*24))===1)a++;else break}return a}calculateAverage(r){return!r||r.length===0?0:Math.round(r.reduce((o,s)=>o+s,0)/r.length)}getRecentResults(r,o=5){return r.slice(0,o).map(s=>({id:s.id,quizName:s.expand?.quiz?.title||"Unknown Quiz",category:s.expand?.quiz?.category||"Unknown",score:s.score||0,date:s.created}))}getTimeAnalytics(r){if(!r||r.length===0)return{totalStudyTime:0,averageTimePerQuiz:0,mostActiveHours:[],studyFrequency:{daily:0,weekly:0,monthly:0}};const o=r.reduce((c,d)=>c+(d.duration||0),0),s=o/r.length,a=new Date,n=r.filter(c=>{const d=new Date(c.created);return a-d<1440*60*1e3}).length,l=r.filter(c=>{const d=new Date(c.created);return a-d<10080*60*1e3}).length,i=r.filter(c=>{const d=new Date(c.created);return a-d<720*60*60*1e3}).length;return{totalStudyTime:Math.round(o/3600*10)/10,averageTimePerQuiz:Math.round(s/60),studyFrequency:{daily:n,weekly:l,monthly:i}}}async getUserRank(r){try{const o=await S.pb.collection("submissions").getFullList({expand:"user,quiz",sort:"-created"}),s=this.groupSubmissionsByUser(o),l=Object.values(s).map(i=>{const c=this.calculateQuestionMetrics(i.submissions);return{userId:i.userId,username:i.username,name:i.name,totalQuizzes:i.submissions.length,averageScore:this.calculateAverage(i.submissions.map(d=>d.score||0)),totalPoints:i.submissions.reduce((d,v)=>d+(v.score||0),0),uniqueQuestionsAnswered:c.uniqueQuestionsAnswered,accuracyRate:c.accuracyRate,totalQuestionsAttempted:c.totalQuestionsAttempted,correctAnswers:c.correctAnswers}}).filter(i=>i.totalQuizzes>=1).sort((i,c)=>this.calculateWeightedScore(c)-this.calculateWeightedScore(i)).findIndex(i=>i.userId===r);return l!==-1?l+1:"N/A"}catch(o){return console.error("Error getting user rank:",o),"N/A"}}groupSubmissionsByUser(r){const o={};return r.forEach(s=>{const a=s.user,n=s.expand?.user;o[a]||(o[a]={userId:a,username:n?.username||"Unknown",name:n?.name||"Unknown User",submissions:[]}),o[a].submissions.push(s)}),o}calculateWeightedScore(r){const{averageScore:o,totalQuizzes:s,uniqueQuestionsAnswered:a,accuracyRate:n}=r;return o*.4+Math.min(s/20,1)*100*.25+Math.min(a/100,1)*100*.2+n*.15}}const f=new L,W={key:0,class:"bg-white rounded-xl shadow-lg p-8 mb-8"},E={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-8 mb-8"},I={class:"flex items-center"},N={class:"ml-3"},F={class:"text-red-700"},V={key:2,class:"bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl shadow-lg p-8 text-white mb-8"},H={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between"},O={class:"mt-6 lg:mt-0"},$={class:"text-center"},G={class:"text-4xl font-bold"},J={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8"},K={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},X={class:"flex items-center"},Y={class:"ml-4"},Z={class:"text-2xl font-bold text-gray-900"},ee={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},te={class:"flex items-center"},se={class:"ml-4"},re={class:"text-2xl font-bold text-gray-900"},oe={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},ae={class:"flex items-center"},ne={class:"ml-4"},le={class:"text-2xl font-bold text-gray-900"},ie={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},de={class:"flex items-center"},ce={class:"ml-4"},ue={class:"text-2xl font-bold text-gray-900"},ge={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},he={class:"flex items-center"},me={class:"ml-4"},xe={class:"text-2xl font-bold text-gray-900"},ve={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},ye={class:"flex items-center"},pe={class:"ml-4"},fe={class:"text-2xl font-bold text-gray-900"},we={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},be={class:"flex items-center"},ke={class:"ml-4"},_e={class:"text-2xl font-bold text-gray-900"},Se={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"},Ae={class:"flex items-center"},ze={class:"ml-4"},Qe={class:"text-2xl font-bold text-gray-900"},qe={key:4,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Me={class:"bg-white rounded-xl shadow-lg border border-gray-200 p-6"},Re={class:"space-y-4"},Te={class:"flex items-center justify-between"},je={class:"flex items-center"},Ce={class:"w-20 bg-gray-200 rounded-full h-2 mr-2"},Ue={class:"text-sm font-medium text-gray-900"},Be={class:"flex items-center justify-between"},Pe={class:"flex items-center"},De={class:"w-20 bg-gray-200 rounded-full h-2 mr-2"},Le={class:"text-sm font-medium text-gray-900"},We={class:"flex items-center justify-between"},Ee={class:"flex items-center"},Ie={class:"w-20 bg-gray-200 rounded-full h-2 mr-2"},Ne={class:"text-sm font-medium text-gray-900"},Fe={key:5,class:"mt-8 bg-white rounded-xl shadow-lg border border-gray-200 p-6"},Ve={class:"overflow-x-auto"},He={class:"min-w-full divide-y divide-gray-200"},Oe={class:"bg-white divide-y divide-gray-200"},$e={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Je={class:"px-6 py-4 whitespace-nowrap"},Ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ze={__name:"PersonalStats",setup(z){const r=Q(),o=w([]),s=w({quizzesCompleted:0,averageScore:0,bestScore:0,totalTime:0,currentRank:"N/A",categoryScores:{excel:0,python:0,pandas:0},improvementTrend:0,studyStreak:0,totalPoints:0,uniqueQuestionsAnswered:0,accuracyRate:0,totalQuestionsAttempted:0,correctAnswers:0}),a=w(!0),n=w(null),l=q(()=>r.user),i=u=>u>=90?"text-green-600 font-semibold":u>=80?"text-blue-600 font-semibold":u>=70?"text-yellow-600 font-semibold":"text-red-600 font-semibold",c=u=>new Date(u).toLocaleDateString(),d=async()=>{if(l.value?.id){a.value=!0,n.value=null;try{const u=await f.getUserSubmissions(l.value.id);if(u.success){const t=u.data;s.value=f.calculateUserStatistics(t);const h=await f.getUserRank(l.value.id);s.value.currentRank=h,o.value=f.getRecentResults(t,5);const b=f.getTimeAnalytics(t);s.value.totalTime=b.totalStudyTime}else n.value=u.error||"Failed to load statistics"}catch(u){n.value="An error occurred while loading statistics",console.error("Error loading statistics:",u)}finally{a.value=!1}}};M(()=>l.value?.id,u=>{u&&(d(),v(u))});const v=u=>{A.subscribeToUserSubmissions(u,t=>{console.log("Real-time update received:",t),d()})};return R(()=>{l.value?.id&&(d(),v(l.value.id))}),T(()=>{l.value?.id&&A.unsubscribeFromUserSubmissions(l.value.id)}),(u,t)=>(m(),j(U,null,{default:C(()=>[a.value?(m(),x("div",W,[...t[0]||(t[0]=[e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e("span",{class:"ml-3 text-lg text-gray-600"},"Loading your statistics...")],-1)])])):n.value?(m(),x("div",E,[e("div",I,[t[2]||(t[2]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",N,[t[1]||(t[1]=e("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Statistics",-1)),e("p",F,g(n.value),1),e("button",{onClick:d,class:"mt-2 text-red-600 hover:text-red-500 underline"}," Try Again ")])])])):(m(),x("div",V,[e("div",H,[t[4]||(t[4]=e("div",{class:"flex-1"},[e("h1",{class:"text-3xl font-bold mb-2"},"Personal Statistics"),e("p",{class:"text-blue-100 text-lg"}," Track your learning progress and performance insights ")],-1)),e("div",O,[e("div",$,[e("div",G,g(s.value.averageScore)+"%",1),t[3]||(t[3]=e("div",{class:"text-blue-100"},"Overall Average",-1))])])])])),!a.value&&!n.value?(m(),x("div",J,[e("div",K,[e("div",X,[t[6]||(t[6]=e("div",{class:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Y,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Quizzes",-1)),e("p",Z,g(s.value.quizzesCompleted),1)])])]),e("div",ee,[e("div",te,[t[8]||(t[8]=e("div",{class:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})])],-1)),e("div",se,[t[7]||(t[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Points",-1)),e("p",re,g(s.value.totalPoints),1)])])]),e("div",oe,[e("div",ae,[t[10]||(t[10]=e("div",{class:"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",ne,[t[9]||(t[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Unique Questions",-1)),e("p",le,g(s.value.uniqueQuestionsAnswered),1)])])]),e("div",ie,[e("div",de,[t[12]||(t[12]=e("div",{class:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",ce,[t[11]||(t[11]=e("p",{class:"text-sm font-medium text-gray-600"},"Accuracy Rate",-1)),e("p",ue,g(s.value.accuracyRate)+"%",1)])])]),e("div",ge,[e("div",he,[t[14]||(t[14]=e("div",{class:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),e("div",me,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Best Score",-1)),e("p",xe,g(s.value.bestScore)+"%",1)])])]),e("div",ve,[e("div",ye,[t[16]||(t[16]=e("div",{class:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",pe,[t[15]||(t[15]=e("p",{class:"text-sm font-medium text-gray-600"},"Study Time",-1)),e("p",fe,g(s.value.totalTime)+"h",1)])])]),e("div",we,[e("div",be,[t[18]||(t[18]=e("div",{class:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1)),e("div",ke,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-600"},"Current Rank",-1)),e("p",_e,"#"+g(s.value.currentRank),1)])])]),e("div",Se,[e("div",Ae,[t[20]||(t[20]=e("div",{class:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"})])],-1)),e("div",ze,[t[19]||(t[19]=e("p",{class:"text-sm font-medium text-gray-600"},"Study Streak",-1)),e("p",Qe,g(s.value.studyStreak)+" days",1)])])])])):k("",!0),!a.value&&!n.value?(m(),x("div",qe,[t[25]||(t[25]=e("div",{class:"lg:col-span-2 bg-white rounded-xl shadow-lg border border-gray-200 p-6"},[e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Score Trend"),e("div",{class:"h-64 flex items-center justify-center bg-gray-50 rounded-lg"},[e("p",{class:"text-gray-500"},"Score trend chart will be displayed here")])],-1)),e("div",Me,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Category Performance",-1)),e("div",Re,[e("div",Te,[t[21]||(t[21]=e("span",{class:"text-sm font-medium text-gray-700"},"Excel",-1)),e("div",je,[e("div",Ce,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:_({width:s.value.categoryScores.excel+"%"})},null,4)]),e("span",Ue,g(s.value.categoryScores.excel)+"%",1)])]),e("div",Be,[t[22]||(t[22]=e("span",{class:"text-sm font-medium text-gray-700"},"Python",-1)),e("div",Pe,[e("div",De,[e("div",{class:"bg-green-600 h-2 rounded-full",style:_({width:s.value.categoryScores.python+"%"})},null,4)]),e("span",Le,g(s.value.categoryScores.python)+"%",1)])]),e("div",We,[t[23]||(t[23]=e("span",{class:"text-sm font-medium text-gray-700"},"Pandas",-1)),e("div",Ee,[e("div",Ie,[e("div",{class:"bg-purple-600 h-2 rounded-full",style:_({width:s.value.categoryScores.pandas+"%"})},null,4)]),e("span",Ne,g(s.value.categoryScores.pandas)+"%",1)])])])])])):k("",!0),!a.value&&!n.value?(m(),x("div",Fe,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Recent Quiz Results",-1)),e("div",Ve,[e("table",He,[t[26]||(t[26]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Quiz"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Category"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Score"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date")])],-1)),e("tbody",Oe,[(m(!0),x(B,null,P(o.value,h=>(m(),x("tr",{key:h.id},[e("td",$e,g(h.quizName),1),e("td",Ge,g(h.category),1),e("td",Je,[e("span",{class:D(i(h.score))},g(h.score)+"%",3)]),e("td",Ke,g(c(h.date)),1)]))),128))])])])])):k("",!0)]),_:1}))}};export{Ze as default};
